# Test Script: Call/Return Functionality
# This script tests the new call/return feature
# and sends messages to the journal (system messages)

# Clear journal before starting
clearsysmsg

sysmsg "=== Starting Call/Return Test ===" 88

# Test 1: Simple Call
sysmsg "Test 1: Simple call to helper script" 68
overhead "Calling helper..."
call 'test-helper'
overhead "Returned from helper!"
sysmsg "Test 1: PASSED - Simple call completed" 68
wait 1000

# Test 2: Call with variable passing
sysmsg "Test 2: Testing variable persistence" 68
setvar 'testvar' 0x400
overhead "Variable set before call"
call 'test-variable-helper'
overhead "Variable should still exist after call"
if varexist 'testvar'
    sysmsg "Test 2: PASSED - Variable persisted" 68
else
    sysmsg "Test 2: FAILED - Variable lost" 38
endif
wait 1000

# Test 3: Nested calls (if supported)
sysmsg "Test 3: Testing nested calls" 68
overhead "Calling level 1..."
call 'test-nested-level1'
overhead "Returned from all levels!"
sysmsg "Test 3: PASSED - Nested calls completed" 68
wait 1000

# Test 4: Early return
sysmsg "Test 4: Testing early return" 68
overhead "Calling script with conditional return..."
call 'test-early-return'
overhead "Returned from early return script!"
sysmsg "Test 4: PASSED - Early return worked" 68
wait 1000

# Test 5: Multiple sequential calls
sysmsg "Test 5: Testing multiple sequential calls" 68

overhead "Calling multiple helpers in sequence..."
call 'test-helper'
wait 500
call 'test-helper'
wait 500
call 'test-helper'
overhead "All sequential calls completed!"
sysmsg "Test 5: PASSED - Sequential calls worked" 68

sysmsg "=== All Call/Return Tests Complete ===" 88
overhead "Testing complete!"
